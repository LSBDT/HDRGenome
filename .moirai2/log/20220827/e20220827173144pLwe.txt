######################################## e20220827173144pLwe ########################################
.moirai2/cmd/j20220827173144ThBZ.json#case	NA18939_v2
.moirai2/cmd/j20220827173144ThBZ.json#case	NA18940_v2
.moirai2/cmd/j20220827173144ThBZ.json#case	NA18941_v2
.moirai2/cmd/j20220827173144ThBZ.json#case	NA18942_v2
.moirai2/cmd/j20220827173144ThBZ.json#project	testDD3
.moirai2/cmd/j20220827173144ThBZ.json#vcftable	testDD3/vcftable.txt
https://moirai2.github.io/schema/daemon/command	.moirai2/cmd/j20220827173144ThBZ.json
https://moirai2.github.io/schema/daemon/execid	e20220827173144pLwe
https://moirai2.github.io/schema/daemon/execute	completed
https://moirai2.github.io/schema/daemon/processtime	0
https://moirai2.github.io/schema/daemon/rootdir	/Users/ah3q/Sites/github/HDRGenome
https://moirai2.github.io/schema/daemon/timecompleted	1661589105
https://moirai2.github.io/schema/daemon/timeended	1661589105
https://moirai2.github.io/schema/daemon/timeregistered	1661589105
https://moirai2.github.io/schema/daemon/timestarted	1661589105
https://moirai2.github.io/schema/daemon/workdir	.moirai2/e20220827173144pLwe
######################################## time ########################################
registered	2022/08/27 17:31:45
start	2022/08/27 17:31:45
end	2022/08/27 17:31:45
completed	2022/08/27 17:31:45
######################################## insert ########################################
root	db/testDD3/case	NA18939_v2
root	db/testDD3/case	NA18940_v2
root	db/testDD3/case	NA18941_v2
root	db/testDD3/case	NA18942_v2
######################################## bash ########################################
#!/bin/sh
export PATH=/Users/ah3q/Sites/github/HDRGenome/.moirai2/e20220827173144pLwe/bin:/Users/ah3q/Sites/github/HDRGenome:/Users/ah3q/Sites/github/HDRGenome/bin:/Users/ah3q/Sites/github/HDRGenome/.moirai2/bin:$PATH
cmdurl=".moirai2/cmd/j20220827173144ThBZ.json"
execid="e20220827173144pLwe"
workdir=".moirai2/e20220827173144pLwe"
rootdir="/Users/ah3q/Sites/github/HDRGenome"
tmpdir=".moirai2/e20220827173144pLwe/tmp"
jobfile=".moirai2/ctrl/job/e20220827173144pLwe.txt"
project="testDD3"
vcftable="testDD3/vcftable.txt"
case=$tmpdir/case
########## init ##########
cd $rootdir
touch $workdir/status.txt
touch $workdir/log.txt
function status() { echo "$1	"`date +%s` >> $workdir/status.txt ; }
function record() { echo "$1	$2" >> $workdir/log.txt ; }
mkdir -p $workdir/bin
cat<<EOF>$workdir/bin/getCases.pl
#!/usr/bin/perl
my \$outline=\$ARGV[0];
my \$line=<STDIN>;
chomp(\$line);
my @cases=split(/\\t/,\$line);
shift(@cases);
shift(@cases);
foreach my \$case(@cases){print "\$case\\n";}
EOF
chmod 755 $workdir/bin/getCases.pl
mkdir -p /tmp/$execid
ln -s /tmp/$execid $tmpdir
status start
########## command ##########
case=(`getCases.pl < $vcftable`)
#############################
status end
if [[ "$(declare -p case)" =~ "declare -a" ]]; then
for out in ${case[@]} ; do
record "$cmdurl#case" "$out"
echo "insert root->$project/case->$out"
done
else
record "$cmdurl#case" "$case"
echo "insert root->$project/case->$case"
fi
rm $workdir/tmp
if [ -z "$(ls -A /tmp/$execid)" ]; then
rmdir /tmp/$execid
else
mv /tmp/$execid $workdir/tmp
fi
status=""
if [ -z "$status" ]; then
if [ -s $workdir/stderr.txt ]; then
status=error
fi
fi
if [ -z "$status" ]; then
status=completed
fi
status $status
sleep 1
touch $workdir/status.txt
