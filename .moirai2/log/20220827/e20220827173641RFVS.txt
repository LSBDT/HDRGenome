######################################## e20220827173641RFVS ########################################
.moirai2/cmd/j20220827173640T5DX.json#hdr	testDD3/hdr/NA18940_v2.hom_region1000000_pick1_skip0_dd.txt
.moirai2/cmd/j20220827173640T5DX.json#input	testDD3/findrun/NA18940_v2.hom_region1000000_pick1_skip0.txt
.moirai2/cmd/j20220827173640T5DX.json#output	testDD3/stats/NA18940_v2.hom_region1000000_pick1_skip0_dd.out
.moirai2/cmd/j20220827173640T5DX.json#project	testDD3
https://moirai2.github.io/schema/daemon/command	.moirai2/cmd/j20220827173640T5DX.json
https://moirai2.github.io/schema/daemon/execid	e20220827173641RFVS
https://moirai2.github.io/schema/daemon/execute	completed
https://moirai2.github.io/schema/daemon/processtime	0
https://moirai2.github.io/schema/daemon/rootdir	/Users/ah3q/Sites/github/HDRGenome
https://moirai2.github.io/schema/daemon/timecompleted	1661589418
https://moirai2.github.io/schema/daemon/timeended	1661589418
https://moirai2.github.io/schema/daemon/timeregistered	1661589418
https://moirai2.github.io/schema/daemon/timestarted	1661589418
https://moirai2.github.io/schema/daemon/workdir	.moirai2/e20220827173641RFVS
######################################## time ########################################
registered	2022/08/27 17:36:58
start	2022/08/27 17:36:58
end	2022/08/27 17:36:58
completed	2022/08/27 17:36:58
######################################## insert ########################################
testDD3/hdr/NA18940_v2.hom_region1000000_pick1_skip0_dd.txt	db/testDD3/stats#log	testDD3/log/stats.NA18940_v2.hom_region1000000_pick1_skip0_dd.txt
testDD3/hdr/NA18940_v2.hom_region1000000_pick1_skip0_dd.txt	db/testDD3/stats	testDD3/stats/NA18940_v2.hom_region1000000_pick1_skip0_dd.out
######################################## bash ########################################
#!/bin/sh
export PATH=/Users/ah3q/Sites/github/HDRGenome:/Users/ah3q/Sites/github/HDRGenome/bin:/Users/ah3q/Sites/github/HDRGenome/.moirai2/bin:$PATH
cmdurl=".moirai2/cmd/j20220827173640T5DX.json"
execid="e20220827173641RFVS"
workdir=".moirai2/e20220827173641RFVS"
rootdir="/Users/ah3q/Sites/github/HDRGenome"
tmpdir=".moirai2/e20220827173641RFVS/tmp"
hdr="testDD3/hdr/NA18940_v2.hom_region1000000_pick1_skip0_dd.txt"
input="testDD3/findrun/NA18940_v2.hom_region1000000_pick1_skip0.txt"
jobfile=".moirai2/ctrl/job/e20220827173641RFVS.txt"
project="testDD3"
output=$tmpdir/output
########## init ##########
cd $rootdir
touch $workdir/status.txt
touch $workdir/log.txt
function status() { echo "$1	"`date +%s` >> $workdir/status.txt ; }
function record() { echo "$1	$2" >> $workdir/log.txt ; }
mkdir -p /tmp/$execid
ln -s /tmp/$execid $tmpdir
status start
########## command ##########
basename=`basename $hdr .txt`
logFile=$project/log/stats.${basename}.txt
perl bin/statdel.pl -o $tmpdir $hdr 2> $logFile
output=`ls $tmpdir/*.out`
filename=`basename $output`
echo "INSERT $hdr->$project/stats#log->$logFile"
#############################
status end
mv $output $project/stats/$filename
output=$project/stats/$filename
if [[ "$(declare -p output)" =~ "declare -a" ]]; then
for out in ${output[@]} ; do
record "$cmdurl#output" "$out"
echo "insert $hdr->$project/stats->$out"
done
else
record "$cmdurl#output" "$output"
echo "insert $hdr->$project/stats->$output"
fi
rm $workdir/tmp
if [ -z "$(ls -A /tmp/$execid)" ]; then
rmdir /tmp/$execid
else
mv /tmp/$execid $workdir/tmp
fi
status=""
if [ -z "$status" ]; then
if [ "$(grep 'Results in file' $workdir/stdout.txt)" != "" ]; then
status=completed
fi
fi
if [ -z "$status" ]; then
if [ -s $workdir/stderr.txt ]; then
status=error
fi
fi
if [ -z "$status" ]; then
status=completed
fi
status $status
sleep 1
touch $workdir/status.txt
